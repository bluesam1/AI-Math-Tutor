# Story 1.8: Problem Display Component

## Status

Completed

## Story

**As a** student,
**I want** to see my submitted problem displayed clearly on the left side of the interface,
**so that** I can reference it while working through the solution.

## Acceptance Criteria

1: The problem display component shows the submitted problem statement in the left panel of the side-by-side layout.

2: The problem text is displayed with clear typography and appropriate spacing, readable for 6th grade students.

3: The problem type is displayed (e.g., "Arithmetic" or "Algebra") as a label or badge near the problem statement.

4: The problem display persists throughout the session until a new problem is submitted (or session is reset).

5: The problem display area is visually distinct from the chat area, maintaining clear visual hierarchy.

6: The component handles long problem statements appropriately (wrapping text, scrolling if needed, maintaining readability).

7: The problem display is accessible via keyboard navigation and screen readers (appropriate ARIA labels).

8: The component is responsive and works effectively on desktop, tablet, and mobile browsers.

## Tasks / Subtasks

- [x] Task 1: Update ProblemPanel Component (AC: 1, 2)
  - [x] Update apps/web/src/components/ProblemPanel.tsx
  - [x] Display problem statement with clear typography
  - [x] Apply appropriate spacing for readability
  - [x] Style problem text with Tailwind CSS
  - [x] Ensure text is readable for 6th grade students

- [x] Task 2: Add Problem Type Display (AC: 3)
  - [x] Create problem type badge/label component
  - [x] Display problem type near problem statement
  - [x] Style problem type badge with Tailwind CSS
  - [x] Use color coding for different problem types (optional)
  - [x] Ensure problem type is clearly visible

- [x] Task 3: Implement Problem State Persistence (AC: 4)
  - [x] Ensure problem state persists in component state
  - [x] Update problem display when new problem is submitted
  - [x] Clear problem display when session is reset (future feature)
  - [x] Maintain problem state across component re-renders

- [x] Task 4: Enhance Visual Distinction (AC: 5)
  - [x] Ensure ProblemPanel is visually distinct from ChatPanel
  - [x] Use different background colors or borders
  - [x] Maintain clear visual hierarchy
  - [x] Ensure both panels are clearly separated

- [x] Task 5: Handle Long Problem Statements (AC: 6)
  - [x] Implement text wrapping for long problems
  - [x] Add scrolling if problem is too long for panel
  - [x] Maintain readability with appropriate line height
  - [x] Test with various problem lengths

- [x] Task 6: Add Accessibility Features (AC: 7)
  - [x] Add ARIA labels to problem display area
  - [x] Add ARIA attributes for problem type
  - [x] Ensure keyboard navigation works
  - [x] Test with screen reader (if available)
  - [x] Add semantic HTML elements

- [x] Task 7: Implement Responsive Design (AC: 8)
  - [x] Test problem display on desktop
  - [x] Test problem display on tablet
  - [x] Test problem display on mobile
  - [x] Ensure problem text is readable on all screen sizes
  - [x] Adjust layout for smaller screens if needed

- [x] Task 8: Integrate with Problem Validation (AC: 3)
  - [x] Receive problem type from validation API (Story 1.7)
  - [x] Display problem type when available
  - [x] Handle cases where problem type is not available
  - [x] Update problem display when validation completes

- [x] Task 9: Create Problem Display Types (AC: 1, 3)
  - [x] Create TypeScript types for problem display props
  - [x] Define problem type enum or union type
  - [x] Export types for use in components
  - [x] Ensure types match backend validation response

- [x] Task 10: Test Problem Display (AC: 1-8)
  - [x] Test with short problem statements
  - [x] Test with long problem statements
  - [x] Test with different problem types
  - [x] Test responsive behavior on different devices
  - [x] Test accessibility features
  - [x] Test problem persistence

## Future Enhancement Tasks

The following tasks are recommended UX improvements identified during post-implementation review. These are optional enhancements that can be implemented in future iterations.

### Priority 1: Collapse Input After Submission

- [ ] Task 11: Implement Collapsed Input State (Priority 1)
  - [ ] Add state management for collapsed/expanded input view
  - [ ] Create "Change Problem" button component
  - [ ] Implement collapse/expand animation transition
  - [ ] Update ProblemPanel to show collapsed state when problem exists
  - [ ] Test expanded state when no problem is loaded
  - [ ] Test collapsed state when problem is displayed
  - [ ] Ensure "Change Problem" button is accessible via keyboard
  - [ ] Add ARIA labels for collapsed/expanded states
  - [ ] Test responsive behavior on mobile/tablet/desktop
  - [ ] Verify smooth animation performance

### Priority 2: Add Loading States

- [ ] Task 12: Implement Loading States (Priority 2)
  - [ ] Create reusable LoadingSpinner component
  - [ ] Create LoadingProgress component for file uploads
  - [ ] Add `isSubmitting` state to ProblemInput component
  - [ ] Add `isUploading` state to ImageUpload component
  - [ ] Add `isProcessing` state for OCR processing
  - [ ] Add `isValidating` state for problem validation
  - [ ] Show loading indicator during text submission
  - [ ] Show progress indicator during image upload
  - [ ] Show processing indicator during OCR
  - [ ] Show validating indicator during problem validation
  - [ ] Add loading messages: "Uploading...", "Processing image...", "Validating problem..."
  - [ ] Test loading states with slow network simulation
  - [ ] Ensure loading states are accessible (screen reader announcements)

### Priority 3: Improve Empty State

- [ ] Task 13: Enhance Empty State Design (Priority 3)
  - [ ] Create dedicated EmptyState component
  - [ ] Design engaging empty state layout
  - [ ] Add friendly greeting: "Ready to learn? ðŸ“"
  - [ ] Add clear call-to-action text
  - [ ] Add example problem hints: "Try: 2x + 5 = ?"
  - [ ] Add visual illustration or icon
  - [ ] Style empty state with Tailwind CSS
  - [ ] Ensure empty state is readable for 6th grade students
  - [ ] Test empty state on different screen sizes
  - [ ] Consider adding onboarding tooltips for first-time users
  - [ ] Test with screen reader for accessibility

### Priority 4: Auto-Submit on File Selection

- [ ] Task 14: Implement Auto-Submit for File Uploads (Priority 4)
  - [ ] Add auto-submit option with configurable delay
  - [ ] Implement drag-and-drop zone: "Drop image here or click to upload"
  - [ ] Add image preview before submission
  - [ ] Add cancel option if user changes mind before auto-submit
  - [ ] Ensure proper error handling for invalid files
  - [ ] Add loading state during auto-submit
  - [ ] Test auto-submit with different file types
  - [ ] Test drag-and-drop functionality
  - [ ] Test auto-submit cancellation flow
  - [ ] Test on mobile devices (touch interactions)
  - [ ] Ensure auto-submit is accessible (keyboard navigation)

### Priority 5: Add Problem Type Icon

- [ ] Task 15: Add Visual Icons to Problem Type Badge (Priority 5)
  - [ ] Install icon library (e.g., Lucide React, Heroicons)
  - [ ] Create icon mapping for each problem type:
    - [ ] Arithmetic icon (ðŸ“Š or calculator icon)
    - [ ] Algebra icon (ðŸ”¢ or variable icon)
    - [ ] Geometry icon (ðŸ“ or shape icon)
    - [ ] Word Problems icon (ðŸ“ or text icon)
    - [ ] Multi-Step icon (ðŸ”„ or steps icon)
  - [ ] Update ProblemTypeBadge component to display icon + text
  - [ ] Style icons with appropriate size and color
  - [ ] Position icons next to or before text label
  - [ ] Ensure icons are properly sized for readability
  - [ ] Test with screen readers (icon + text label)
  - [ ] Test icon visibility on different screen sizes
  - [ ] Verify icon accessibility (proper alt text/aria-labels)

## Dev Notes

### Previous Story Insights

**Story 1.2: React Frontend Shell**

- Side-by-side layout is established with ProblemPanel
- Tailwind CSS v4.1.16 is configured
- Layout is responsive

**Story 1.4: Text Input for Math Problems**

- Problem input is implemented
- Problem state is managed

**Story 1.7: Problem Validation & Type Identification**

- Problem validation endpoint is implemented
- Problem type is identified and returned

### Project Structure

The problem display component updates the existing frontend structure:

```
apps/web/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProblemPanel.tsx        # UPDATED: Enhanced problem display
â”‚   â”œâ”€â”€ ProblemTypeBadge.tsx   # NEW: Problem type badge component
â”‚   â”œâ”€â”€ ProblemInput.tsx        # Already exists
â”‚   â””â”€â”€ ChatPanel.tsx           # Already exists
â”œâ”€â”€ types/
â”‚   â””â”€â”€ problem.ts              # UPDATED: Add problem type definitions
â””â”€â”€ App.tsx                     # Main app component
```

### Technology Stack Requirements

**Frontend Dependencies:**

- React: ^18.2.0 (already installed) [Source: architecture/tech-stack.md#Frontend Dependencies]
- React Hooks: useState (built-in)
- Tailwind CSS: v4.1.16 (already installed) [Source: architecture/tech-stack.md#Frontend Dependencies]

**No additional dependencies required** - using built-in React features and Tailwind CSS.

### Coding Standards

**Critical Rules:**

- TypeScript Only: All code must be TypeScript - `.tsx` for React components [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Functional Components: Use functional components with React Hooks [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Component Naming: PascalCase for components [Source: architecture/coding-standards.md#Naming Conventions]

**Styling Guidelines:**

- Use Tailwind CSS utility classes for all styling
- Maintain consistent spacing and typography
- Ensure age-appropriate design

### File Locations

**Component Files:**

- `apps/web/src/components/ProblemPanel.tsx` - Problem display component (UPDATED)
- `apps/web/src/components/ProblemTypeBadge.tsx` - Problem type badge (NEW)

**Type Files:**

- `apps/web/src/types/problem.ts` - Problem type definitions (UPDATED)
- `packages/shared/src/types/problem.ts` - Shared problem types (for frontend/backend)

### UI/UX Design

**Problem Display Design:**

- Clear, readable typography (appropriate font size for 6th grade)
- Generous spacing for readability
- Visual distinction from chat area
- Problem type badge/label clearly visible

**Problem Type Badge:**

- Color-coded badges for each problem type (optional)
- Clear labels: "Arithmetic", "Algebra", "Geometry", "Word Problems", "Multi-Step"
- Positioned near problem statement
- Age-appropriate styling

**Long Problem Handling:**

- Text wrapping for long problems
- Scrollable container if problem is too long
- Maintain line height and spacing for readability
- Ensure problem is fully visible (with scrolling)

### Problem Type Display

**Problem Type Categories:**

1. **Arithmetic:** Basic operations with numbers
2. **Algebra:** Variables and equations
3. **Geometry:** Shapes and measurements
4. **Word Problems:** Real-world scenarios
5. **Multi-Step:** Problems requiring multiple steps

**Badge Design:**

- Clear, readable labels
- Color coding (optional, for visual distinction)
- Consistent styling across all types
- Positioned prominently near problem statement

### State Management

**Component State:**

- `problemText` - Problem statement (string)
- `problemType` - Problem type (ProblemType | null)
- `isValidated` - Whether problem has been validated (boolean)

**State Flow:**

1. Problem submitted â†’ updates `problemText`
2. Validation completes â†’ updates `problemType` and `isValidated`
3. Problem display updates with text and type
4. Problem persists until new problem is submitted

### Accessibility

**Accessibility Requirements:**

- ARIA labels for problem display area
- ARIA attributes for problem type
- Semantic HTML elements (article, section)
- Keyboard navigation support
- Screen reader compatibility

**ARIA Attributes:**

- `aria-label="Math problem"` for problem display
- `aria-labelledby` for problem type
- `role="region"` for problem panel

### Responsive Design

**Responsive Breakpoints:**

- Desktop (> 1024px): Full side-by-side layout, problem display in left panel
- Tablet (768px - 1024px): Side-by-side with adjusted widths
- Mobile (< 768px): Stacked layout, problem display full width

**Responsive Considerations:**

- Problem text remains readable on all screen sizes
- Problem type badge remains visible
- Scrolling works properly on mobile devices
- Touch-friendly interaction on mobile

### Testing

**Testing Strategy:**

- Manual testing with various problem lengths
- Manual testing with different problem types
- Manual testing on different screen sizes
- Accessibility testing
- TypeScript compilation verification

**Test Scenarios:**

1. Display short problem â†’ should show correctly
2. Display long problem â†’ should wrap and scroll
3. Display problem with type â†’ should show type badge
4. Test responsive behavior on mobile/tablet/desktop
5. Test accessibility with screen reader
6. Test problem persistence

**Test File Locations:**

- Component tests: `apps/web/tests/components/ProblemPanel.test.tsx` (to be created in later stories)

### Integration Points

**Current Story:**

- Displays problem text from ProblemInput (Story 1.4)
- Displays problem type from validation API (Story 1.7)
- Integrates with existing ProblemPanel component

**Future Stories:**

- Future epics: Problem display will be referenced during Socratic dialogue
- Problem type will guide dialogue approach

### UX Enhancement Recommendations

Based on UX analysis, the following priority improvements have been identified for future implementation:

#### Priority 1: Collapse Input After Submission (Highest Impact)

**Current State:** Input controls remain visible after problem submission, taking up valuable space and creating visual clutter.

**Recommendation:**

- Collapse input section to a minimal "Change Problem" button after submission
- Make the problem display the hero element once a problem is loaded
- Use progressive disclosure to show/hide input controls based on state

**Benefits:**

- Clearer visual hierarchy
- More focus on the problem being solved
- Better use of screen real estate
- Reduced cognitive load

**Implementation Notes:**

- Add state management for collapsed/expanded input view
- Smooth transition animation when collapsing/expanding
- Ensure "Change Problem" button is easily accessible

#### Priority 2: Add Loading States (Better Feedback)

**Current State:** Limited feedback during problem submission and processing.

**Recommendation:**

- Add clear loading indicators during:
  - Problem submission (text input)
  - Image upload and OCR processing
  - Problem validation
- Show progress states: "Uploading...", "Processing image...", "Validating problem..."
- Use skeleton loaders or progress bars for better UX

**Benefits:**

- Users understand what's happening
- Reduces uncertainty and anxiety
- Better perceived performance

**Implementation Notes:**

- Add `isSubmitting`, `isUploading`, `isProcessing` states
- Create reusable loading components
- Consider using React Suspense for async states

#### Priority 3: Improve Empty State (More Actionable)

**Current State:** Passive empty state message: "Enter a math problem above to get started!"

**Recommendation:**

- Replace with more engaging, actionable empty state:
  - Friendly greeting: "Ready to learn? ðŸ“"
  - Clear call-to-action: "Get started by typing a problem or uploading a photo"
  - Example hint: "Try: 2x + 5 = ?"
  - Visual illustration or icon

**Benefits:**

- More engaging first impression
- Clearer guidance on what to do
- Reduced friction for new users

**Implementation Notes:**

- Create dedicated EmptyState component
- Add example problems or hints
- Consider adding onboarding tooltips for first-time users

#### Priority 4: Auto-Submit on File Selection (Reduce Friction)

**Current State:** Two-step process: select file â†’ click submit button

**Recommendation:**

- Auto-submit image immediately after file selection (with loading state)
- OR show image preview with inline submit button (more compact)
- Add drag-and-drop zone: "Drop image here or click to upload"

**Benefits:**

- Faster workflow (fewer clicks)
- Better mobile experience
- More intuitive interaction

**Implementation Notes:**

- Add auto-submit option with configurable delay
- Implement drag-and-drop functionality
- Add image preview before submission
- Ensure proper error handling for invalid files

#### Priority 5: Add Problem Type Icon (Visual Clarity)

**Current State:** Problem type badge only shows text label (e.g., "Arithmetic")

**Recommendation:**

- Add visual icons for each problem type:
  - ðŸ“Š Arithmetic (numbers/calculations)
  - ðŸ“ Geometry (shapes/measurements)
  - ðŸ”¢ Algebra (variables/equations)
  - ðŸ“ Word Problems (text scenarios)
  - ðŸ”„ Multi-Step (complex problems)
- Position icon next to or before text label
- Consider making icon more prominent than text

**Benefits:**

- Faster visual recognition
- Better for younger students (6th grade)
- More engaging and memorable
- Improved accessibility (visual + text)

**Implementation Notes:**

- Create icon mapping for each problem type
- Use consistent icon library (e.g., Lucide React, Heroicons)
- Ensure icons are properly sized and accessible
- Test with screen readers (icon + text label)

#### Implementation Priority Order

1. **Collapse input after submission** - Highest user impact, medium complexity
2. **Add loading states** - High user impact, low complexity
3. **Improve empty state** - Medium user impact, low complexity
4. **Auto-submit on file selection** - Medium user impact, medium complexity
5. **Add problem type icon** - Low user impact, low complexity

#### Estimated Effort

- Priority 1: 4-6 hours
- Priority 2: 2-3 hours
- Priority 3: 2-3 hours
- Priority 4: 3-4 hours
- Priority 5: 1-2 hours

**Total Estimated Effort:** 12-18 hours

### Environment Variables

No environment variables required for this story.

## Change Log

| Date       | Version | Description                          | Author            |
| ---------- | ------- | ------------------------------------ | ----------------- |
| 2025-01-XX | 1.0     | Story created                        | SM                |
| 2025-11-05 | 2.0     | Story completed                      | Claude Sonnet 4.5 |
| 2025-11-05 | 2.1     | Added UX enhancement recommendations | Product Manager   |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

- Fixed "Unexpected end of form" error in Firebase Functions file upload
- Implemented express-multipart-file-parser for Firebase Functions v2 compatibility
- Multiple iterations debugging multipart/form-data handling in Firebase Functions

### Completion Notes List

1. **Story 1.8 Implementation**: Successfully implemented all UI components for problem display
   - Updated ProblemPanel with enhanced typography and responsive design
   - Created ProblemTypeBadge component with color-coded problem types
   - Added comprehensive ARIA labels and accessibility features
   - Implemented scrolling for long problem statements
   - Enhanced visual distinction between problem and chat panels

2. **Firebase Functions File Upload Fix**: Resolved persistent "Unexpected end of form" error
   - Root cause: Firebase Functions v2 pre-processes request body, incompatible with standard multipart parsers
   - Solution: Replaced custom busboy implementation with express-multipart-file-parser
   - This middleware is specifically designed for Firebase Functions environment
   - Updated parse-image route to use req.files array from the parser
   - Successfully built and deployed with all TypeScript errors resolved

### File List

**Created:**

- apps/web/src/components/ProblemTypeBadge.tsx
- functions/src/types/express-multipart-file-parser.d.ts

**Modified:**

- apps/web/src/components/ProblemPanel.tsx
- apps/web/src/components/ChatPanel.tsx
- apps/web/src/types/index.ts
- apps/web/src/services/api.ts
- functions/index.ts
- functions/src/server.ts
- functions/src/routes/problem.ts
- functions/package.json (added express-multipart-file-parser)

**Deleted:**

- functions/src/middleware/fileUpload.ts (replaced by express-multipart-file-parser)

## QA Results

_TBD - To be filled by QA Agent_

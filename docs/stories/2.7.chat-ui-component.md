# Story 2.7: Chat UI Component

## Status

Pending

## Story

**As a** student,
**I want** to see my conversation with the tutor in a chat interface,
**so that** I can follow our dialogue and see my progress.

## Acceptance Criteria

1: A chat UI component is created in the React frontend that displays the conversation in the right panel of the side-by-side layout.

2: The chat component displays messages in a conversation format, with user messages and system responses clearly distinguished (different styling, alignment, or icons).

3: The chat component includes:

- A message list displaying all messages in chronological order
- A message input field at the bottom for students to type responses
- A send button to submit messages

4: The chat component handles message submission, sending student messages to the backend API endpoint (POST /api/chat/message).

5: The chat component displays system responses as they are received, with loading indicators while waiting for LLM responses.

6: The chat component automatically scrolls to show the latest messages when new messages are added.

7: The chat component handles long messages appropriately (wrapping text, maintaining readability, scrolling if needed).

8: The chat component is accessible via keyboard navigation and supports standard input behaviors (select, copy, paste).

9: The chat component is responsive and works effectively on desktop, tablet, and mobile browsers.

10: The chat component displays error messages appropriately when API calls fail, with clear, age-appropriate error messages.

## Tasks / Subtasks

- [ ] Task 1: Create Chat Component Structure (AC: 1)
  - [ ] Create `apps/web/src/components/ChatInterface.tsx` (or similar name)
  - [ ] Set up component structure with React hooks
  - [ ] Define TypeScript interfaces for messages
  - [ ] Create component props interface
  - [ ] Set up basic component layout

- [ ] Task 2: Design Message List UI (AC: 2, 3)
  - [ ] Create message list container
  - [ ] Display messages in chronological order
  - [ ] Style user messages (e.g., right-aligned, different color)
  - [ ] Style system messages (e.g., left-aligned, different color)
  - [ ] Add visual distinction (icons, avatars, or styling)
  - [ ] Ensure messages are clearly distinguishable

- [ ] Task 3: Create Message Input Component (AC: 3)
  - [ ] Create message input field
  - [ ] Add label or placeholder text
  - [ ] Style input field with Tailwind CSS
  - [ ] Ensure input is accessible (aria-label, etc.)
  - [ ] Support multi-line input if needed

- [ ] Task 4: Create Send Button Component (AC: 3)
  - [ ] Create send button component
  - [ ] Style button with Tailwind CSS
  - [ ] Add send icon or text
  - [ ] Position button appropriately
  - [ ] Ensure button is accessible

- [ ] Task 5: Implement Message State Management (AC: 1, 2)
  - [ ] Create React state for messages array
  - [ ] Add function to add new messages
  - [ ] Format messages with type (user/system), content, timestamp
  - [ ] Manage message state updates

- [ ] Task 6: Implement API Integration (AC: 4)
  - [ ] Create API service function for POST /api/chat/message
  - [ ] Update `apps/web/src/services/api.ts` with chat endpoint
  - [ ] Handle request body (problem statement, student message, session ID)
  - [ ] Handle response (dialogue text, metadata)
  - [ ] Integrate with chat component

- [ ] Task 7: Implement Message Submission (AC: 4)
  - [ ] Create submit handler function
  - [ ] Validate input before submission
  - [ ] Send message to backend API
  - [ ] Add user message to message list immediately
  - [ ] Clear input field after submission
  - [ ] Handle submission errors

- [ ] Task 8: Implement Loading States (AC: 5)
  - [ ] Show loading indicator while waiting for LLM response
  - [ ] Display "typing..." or spinner animation
  - [ ] Add system message when response is loading
  - [ ] Remove loading indicator when response arrives
  - [ ] Handle timeout scenarios

- [ ] Task 9: Implement Auto-Scroll (AC: 6)
  - [ ] Auto-scroll to bottom when new messages are added
  - [ ] Use React refs to access message list container
  - [ ] Scroll smoothly to latest message
  - [ ] Handle scroll behavior on initial load
  - [ ] Consider user scroll position (don't auto-scroll if user scrolled up)

- [ ] Task 10: Handle Long Messages (AC: 7)
  - [ ] Style messages to wrap text appropriately
  - [ ] Ensure readability for long messages
  - [ ] Add scrolling if message container is too long
  - [ ] Test with various message lengths
  - [ ] Maintain visual hierarchy

- [ ] Task 11: Implement Accessibility Features (AC: 8)
  - [ ] Add proper ARIA labels to message list
  - [ ] Add ARIA labels to input field
  - [ ] Ensure keyboard navigation works (Tab, Enter, Escape)
  - [ ] Support standard input behaviors (select, copy, paste)
  - [ ] Test with screen reader if available

- [ ] Task 12: Implement Responsive Design (AC: 9)
  - [ ] Ensure chat works on desktop browsers
  - [ ] Ensure chat works on tablet browsers
  - [ ] Ensure chat works on mobile browsers
  - [ ] Adjust layout for different screen sizes
  - [ ] Test responsive behavior

- [ ] Task 13: Integrate with App Layout (AC: 1)
  - [ ] Add ChatInterface component to App.tsx
  - [ ] Position chat in right panel (side-by-side layout)
  - [ ] Ensure proper spacing and layout
  - [ ] Integrate with existing problem display panel
  - [ ] Maintain responsive layout

- [ ] Task 14: Implement Error Handling (AC: 10)
  - [ ] Handle API call failures
  - [ ] Display age-appropriate error messages
  - [ ] Style error messages appropriately (not scary, friendly)
  - [ ] Allow retry on error
  - [ ] Log errors for debugging

- [ ] Task 15: Add Session Management (AC: 4)
  - [ ] Generate or retrieve session ID
  - [ ] Include session ID in API requests
  - [ ] Maintain session across page refreshes (if needed)
  - [ ] Clear session when new problem is started

- [ ] Task 16: Add Message Metadata Display (AC: 2, 5)
  - [ ] Display response metadata (question, hint, encouragement) if available
  - [ ] Use metadata for visual feedback (icons, colors)
  - [ ] Enhance message display with metadata
  - [ ] Prepare for Story 3.2 visual feedback integration

- [ ] Task 17: Add Unit Tests (AC: 1-10)
  - [ ] Create test file for ChatInterface component
  - [ ] Test message display
  - [ ] Test message submission
  - [ ] Test loading states
  - [ ] Test error handling
  - [ ] Test accessibility features

- [ ] Task 18: Integration Testing (AC: 1-10)
  - [ ] Test with real backend API
  - [ ] Test message flow end-to-end
  - [ ] Test error scenarios
  - [ ] Test responsive behavior
  - [ ] Test across different browsers
  - [ ] Test with actual LLM responses

## Dependencies

- Story 2.2: Socratic Dialogue Generation Endpoint (consumes this endpoint)
- Story 2.5: Answer Blocking & Response Rewriting (receives checked/rewritten responses)
- Story 2.6: Context Management Service (uses context for coherent conversations)

## Required By

- Story 3.2: Visual Feedback Components (will enhance chat with visual feedback)

## Notes

- Integrates with existing App.tsx side-by-side layout
- Should be age-appropriate for 6th grade students
- Error messages should be friendly and encouraging
- Consider adding message timestamps (optional, for debugging)
- Prepare for math rendering integration in Epic 3 (Story 3.1)

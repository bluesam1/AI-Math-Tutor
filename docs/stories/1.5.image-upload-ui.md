# Story 1.5: Image Upload UI Component

## Status

Draft

## Story

**As a** student,
**I want** to upload images containing printed math problems,
**so that** I can submit problems without typing them manually.

## Acceptance Criteria

1: An image upload button or drag-and-drop zone is displayed in the interface (near the text input field or in the left panel).

2: Students can click the upload button to select an image file from their device, or drag-and-drop an image file onto the upload zone.

3: Supported image formats are clearly indicated (e.g., "JPG, PNG, GIF" or similar) with appropriate validation.

4: When an image is selected, visual feedback is provided (e.g., image preview, loading indicator, file name display).

5: The image file is validated for size limits (e.g., max 10MB) and format (JPG, PNG, GIF) before upload.

6: Error handling is implemented for invalid files (wrong format, too large, etc.) with clear, age-appropriate error messages.

7: The upload button/zone is accessible via keyboard navigation and supports standard file input behaviors.

8: After successful image selection, the image is ready for processing (displayed in preview or queued for Vision API parsing).

## Tasks / Subtasks

- [ ] Task 1: Create Image Upload Component (AC: 1, 2, 7)
  - [ ] Create apps/web/src/components/ImageUpload.tsx
  - [ ] Implement file input element (hidden, for click selection)
  - [ ] Implement drag-and-drop zone
  - [ ] Add upload button with clear label
  - [ ] Style upload zone with Tailwind CSS (age-appropriate)
  - [ ] Ensure keyboard navigation works
  - [ ] Add proper accessibility attributes

- [ ] Task 2: Implement Drag-and-Drop Functionality (AC: 2)
  - [ ] Add drag event handlers (onDragOver, onDragLeave, onDrop)
  - [ ] Visual feedback during drag (highlight zone)
  - [ ] Handle file drop event
  - [ ] Prevent default browser drag behavior
  - [ ] Test drag-and-drop on different browsers

- [ ] Task 3: Implement File Selection (AC: 2)
  - [ ] Handle file input change event
  - [ ] Extract selected file from input
  - [ ] Support both click selection and drag-and-drop
  - [ ] Ensure file selection works consistently

- [ ] Task 4: Implement File Validation (AC: 3, 5)
  - [ ] Create validation function for file format (JPG, PNG, GIF)
  - [ ] Create validation function for file size (max 10MB)
  - [ ] Validate file format before processing
  - [ ] Validate file size before processing
  - [ ] Display supported formats clearly in UI

- [ ] Task 5: Create Image Preview Component (AC: 4, 8)
  - [ ] Create image preview display
  - [ ] Show image thumbnail when selected
  - [ ] Display file name and size
  - [ ] Add loading indicator for future API processing
  - [ ] Style preview with Tailwind CSS
  - [ ] Handle image loading errors

- [ ] Task 6: Implement Error Handling (AC: 6)
  - [ ] Create error message display
  - [ ] Show error for invalid file format
  - [ ] Show error for file too large
  - [ ] Show error for other file errors
  - [ ] Style error messages (age-appropriate, friendly)
  - [ ] Clear errors when valid file is selected

- [ ] Task 7: Integrate with Problem Input (AC: 1, 8)
  - [ ] Add ImageUpload component near ProblemInput
  - [ ] Coordinate between text input and image upload
  - [ ] Update layout to accommodate both input methods
  - [ ] Ensure both input methods work together

- [ ] Task 8: Implement File State Management (AC: 4, 8)
  - [ ] Create React state for selected file
  - [ ] Create React state for image preview URL
  - [ ] Create React state for loading state
  - [ ] Create React state for error state
  - [ ] Update states on file selection/validation

- [ ] Task 9: Add Accessibility Features (AC: 7)
  - [ ] Add ARIA labels to upload button
  - [ ] Add ARIA attributes to drag-and-drop zone
  - [ ] Add ARIA attributes for error messages
  - [ ] Ensure keyboard navigation works
  - [ ] Test with screen reader (if available)

- [ ] Task 10: Create File Utility Functions (AC: 3, 5)
  - [ ] Create apps/web/src/utils/fileUtils.ts
  - [ ] Implement file format validation function
  - [ ] Implement file size validation function
  - [ ] Implement file type checking utilities
  - [ ] Export utility functions for reuse

- [ ] Task 11: Test Image Upload Functionality (AC: 1-8)
  - [ ] Test clicking upload button to select file
  - [ ] Test drag-and-drop file selection
  - [ ] Test file format validation (JPG, PNG, GIF)
  - [ ] Test file size validation (max 10MB)
  - [ ] Test image preview display
  - [ ] Test error handling for invalid files
  - [ ] Test keyboard navigation
  - [ ] Test responsive behavior on mobile/tablet

## Dev Notes

### Previous Story Insights

**Story 1.4: Text Input for Math Problems**

- Text input component is implemented
- Problem state management is established
- Validation and error handling patterns are established

### Project Structure

The image upload functionality integrates with the existing frontend structure:

```
apps/web/src/
├── components/
│   ├── Layout.tsx              # Main layout
│   ├── ProblemPanel.tsx        # Left panel
│   ├── ProblemInput.tsx        # Text input component
│   ├── ImageUpload.tsx         # NEW: Image upload component
│   └── ChatPanel.tsx           # Right panel
├── utils/
│   └── fileUtils.ts            # NEW: File validation utilities
└── types/
    └── file.ts                 # NEW: File type definitions
```

### Technology Stack Requirements

**Frontend Dependencies:**

- React: ^18.2.0 (already installed) [Source: architecture/tech-stack.md#Frontend Dependencies]
- React Hooks: useState, useRef (built-in)
- Tailwind CSS: v4.1.16 (already installed) [Source: architecture/tech-stack.md#Frontend Dependencies]

**No additional dependencies required** - using built-in React features, HTML5 File API, and Tailwind CSS.

### Coding Standards

**Critical Rules:**

- TypeScript Only: All code must be TypeScript - `.tsx` for React components [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Functional Components: Use functional components with React Hooks [Source: architecture/coding-standards.md#Critical Fullstack Rules]
- Component Naming: PascalCase for components [Source: architecture/coding-standards.md#Naming Conventions]

**File Handling:**

- Use HTML5 File API for file selection
- Validate files on client side before processing
- Create object URLs for image preview (remember to revoke)

### File Locations

**Component Files:**

- `apps/web/src/components/ImageUpload.tsx` - Image upload component (NEW)
- `apps/web/src/components/ProblemInput.tsx` - May need updates for integration

**Utility Files:**

- `apps/web/src/utils/fileUtils.ts` - File validation utilities (NEW)

**Type Files:**

- `apps/web/src/types/file.ts` - File type definitions (NEW)

### UI/UX Design

**Upload Zone Design:**

- Clear label: "Upload Image" or "Drag image here or click to select"
- Large, visible drag-and-drop zone
- Visual feedback during drag (highlight, border change)
- Age-appropriate styling (friendly, approachable)
- Supported formats clearly displayed: "JPG, PNG, GIF (max 10MB)"

**Image Preview:**

- Thumbnail display of selected image
- File name and size displayed
- Loading indicator for future API processing
- Option to remove/clear selected image

**Error Messages:**

- Friendly, age-appropriate error messages
- Examples:
  - "Please select a JPG, PNG, or GIF image"
  - "This file is too large. Please select an image smaller than 10MB"
- Clear indication of what needs to be fixed
- Visual distinction (not alarming)

### File Validation

**Supported Formats:**

- JPG/JPEG
- PNG
- GIF

**File Size Limit:**

- Maximum: 10MB
- Validate before processing
- Show clear error if exceeded

**Validation Functions:**

- `validateFileFormat(file: File): boolean` - Check file MIME type
- `validateFileSize(file: File, maxSizeMB: number): boolean` - Check file size
- `getFileExtension(file: File): string` - Extract file extension

### State Management

**Component State:**

- `selectedFile` - Selected file object (File | null)
- `previewUrl` - Image preview URL (string | null)
- `isLoading` - Loading state (boolean)
- `error` - Error message (string | null)
- `isDragging` - Drag state (boolean)

**State Flow:**

1. User selects/drops file → updates `selectedFile`
2. Validate file → if valid, create preview URL; if invalid, show error
3. Display preview → updates `previewUrl`
4. Ready for processing → file is available for Vision API (Story 1.6)

### Accessibility

**Accessibility Requirements:**

- ARIA labels for upload button
- ARIA attributes for drag-and-drop zone
- ARIA attributes for error messages
- Keyboard navigation support
- Screen reader compatibility
- Focus management

**Keyboard Navigation:**

- Tab: Navigate to upload button
- Enter/Space: Trigger file selection
- Escape: Clear selected file (optional)

### Testing

**Testing Strategy:**

- Manual testing for file selection
- Manual testing for drag-and-drop
- Manual testing for file validation
- Manual testing for image preview
- Browser testing on different devices
- TypeScript compilation verification

**Test Scenarios:**

1. Click upload button → select file → should show preview
2. Drag-and-drop file → should show preview
3. Select invalid format → should show error
4. Select file too large → should show error
5. Select valid file → should show preview
6. Test keyboard navigation
7. Test responsive behavior on mobile/tablet

**Test File Locations:**

- Component tests: `apps/web/tests/components/ImageUpload.test.tsx` (to be created in later stories)

### Integration Points

**Current Story:**

- Frontend-only implementation
- Image preview and validation
- No backend API calls yet
- File ready for processing (Story 1.6)

**Future Stories:**

- Story 1.6: Vision API integration will process the uploaded image
- Story 1.4: Text input and image upload work together (user can choose either method)

### Environment Variables

No environment variables required for this story.

## Change Log

| Date       | Version | Description   | Author |
| ---------- | ------- | ------------- | ------ |
| 2025-01-XX | 1.0     | Story created | SM     |

## Dev Agent Record

### Agent Model Used

_TBD - To be filled by Dev Agent_

### Debug Log References

_TBD - To be filled by Dev Agent_

### Completion Notes List

_TBD - To be filled by Dev Agent_

### File List

_TBD - To be filled by Dev Agent_

## QA Results

_TBD - To be filled by QA Agent_


